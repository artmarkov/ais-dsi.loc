<?php

use yii\db\Migration;

class m210301_151057_create_table_subject extends Migration
{
    public function up()
    {
        $tableOptions = null;
        if ($this->db->driverName === 'mysql') {
            $tableOptions = 'CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE=InnoDB';
        }

        $this->createTable('{{%subject}}', [
            'id' => $this->primaryKey(8)->unsigned(),
            'name' => $this->string(64),
            'slug' => $this->string(32),
            'order' => $this->integer(8)->unsigned()->notNull(),
            'status' => $this->tinyInteger(2)->unsigned()->notNull(),
        ], $tableOptions);

        $this->db->createCommand()->batchInsert('{{%subject}}', ['name', 'slug', 'order', 'status'], [

            ['Академический вокал', 'Акад.вок.', 0, 1],
            ['Аккордеон', 'Акк-н', 0, 1],
            ['Акробатика', 'Акробатика', 0, 1],
            ['Актерское мастерство', 'Акт.маст', 0, 1],
            ['Альт', 'Альт', 0, 1],
            ['Ансамбль духовых инструментов', 'Анс.дух.инстр.', 0, 1],
            ['Ансамбль народных инструментов', 'Анс.нар.инстр.', 0, 1],
            ['Ансамбль', 'Анс.', 0, 1],
            ['Арфа', 'Арфа', 0, 1],
            ['Архитектурное творчество', 'Арх.тв.', 0, 1],
            ['Архитектурные стили', 'Арх.ст.', 0, 1],
            ['Архитектурный рисунок', 'Арх.рис.', 0, 1],
            ['Балалайка', 'Бал', 0, 1],
            ['Баллетная гимнастика', 'Бал.гимн', 0, 1],
            ['Бально-спортивный танец', 'Бал-спорт.тан', 0, 1],
            ['Баритон', 'Барит', 0, 1],
            ['Бас гитара', 'Б.гит', 0, 1],
            ['Баян', 'Баян', 0, 1],
            ['Беседы об искусстве', 'Беседы об иск-ве', 0, 1],
            ['Беседы по хореографическому искусству', 'Беседы по хореогр-му иск-ву', 0, 1],
            ['Блок флейта', 'Бл.фл', 0, 1],
            ['Брейк-данс', 'Брейк-данс', 0, 1],
            ['Валторна', 'Валт', 0, 1],
            ['Веселая арифметика', 'Арифм.', 0, 1],
            ['Веселые нотки', 'Вес.нотки', 0, 1],
            ['Виолончель', 'Виол', 0, 1],
            ['Вокал', 'Вок', 0, 1],
            ['Вокально-хоровой ансамбль', 'Вок-хор.анс.', 0, 1],
            ['Вокальный ансамбль', 'Вок.анс.', 0, 1],
            ['Вокальный эстрадно-джазовый ансамбль', 'Вок.анс.', 0, 1],
            ['Гармонь', 'Гарм', 0, 1],
            ['Гимнастика', 'Гим-ка', 0, 1],
            ['Гитара', 'Гитар', 0, 1],
            ['Графика', 'Граф.', 0, 1],
            ['Гусли', 'Гусли', 0, 1],
            ['Декоративно-прикладное искусство', 'ДПИ', 0, 1],
            ['Декорирование', 'Декор', 0, 1],
            ['Детские массовые танцы', 'ДМТ', 0, 1],
            ['Джазовый ансамбль', 'джаз.анс.', 0, 1],
            ['Домра', 'Домр', 0, 1],
            ['Живопись', 'Жив-сь.', 0, 1],
            ['Импровизация', 'Импр.', 0, 1],
            ['Историко-бытовой и бальный танец', 'Бальн.тан.', 0, 1],
            ['История архитектуры', 'Ист.арх.', 0, 1],
            ['История джаза', 'Ист.дж.', 0, 1],
            ['История изобразительного искусства', 'Ист.ИЗО', 0, 1],
            ['История искусств', 'Ист.иск.', 0, 1],
            ['Кларнет', 'Клар', 0, 1],
            ['Классический станок', 'Класс.ст.', 0, 1],
            ['Классический танец', 'Класс.танец', 0, 1],
            ['Классический экзерсис', 'Кл.Экз', 0, 1],
            ['Композиционная постановка танца', 'КПТ', 0, 1],
            ['Композиция (станковая, прикладная)', 'Комп.', 0, 1],
            ['Композиция', 'Комп', 0, 1],
            ['Латина соло', 'Латина соло', 0, 1],
            ['Лепка', 'Лепка', 0, 1],
            ['Логопедия', 'Лого', 0, 1],
            ['Логоритмика', 'Логоритмика', 0, 1],
            ['Макетирование', 'Макет', 0, 1],
            ['Мастерство актера', 'Маст.акт.', 0, 1],
            ['Материаловедение', 'Мат.вед.', 0, 1],
            ['Музыкальная грамота', 'Муз.гр.', 0, 1],
            ['Музыкальная информатика', 'Муз.инф.', 0, 1],
            ['Музыкальная литература и слушание музыки', 'Муз.лит.сл.муз.', 0, 1],
            ['Музыкальная литература', 'Муз.лит.', 0, 1],
            ['Народная хореография', 'Нар.хореогр.', 0, 1],
            ['Народно-сценический танец', 'Нар-сц.тан.', 0, 1],
            ['Народное творчество', 'Нар.тв-во', 0, 1],
            ['Народный оркестр', 'Нар.орк.', 0, 1],
            ['Народный характерный танец', 'НХТ', 0, 1],
            ['Народный хор', 'Нар.хор', 0, 1],
            ['Натурный рисунок', 'Нат.рис.', 0, 1],
            ['Орган', 'Орган', 0, 1],
            ['Оркестр аккордеонистов', 'Орк. аккорд.', 0, 1],
            ['Оркестр гитаристов', 'орк.гит.', 0, 1],
            ['Оркестр духовых инструментов', 'дух.орк.', 0, 1],
            ['Основы ИЗО', 'Осн.ИЗО', 0, 1],
            ['Основы актерского мастерства', 'Осн.акт.маст.', 0, 1],
            ['Основы бального танца', 'Основы бальн.танца', 0, 1],
            ['Основы графики', 'Осн.граф.', 0, 1],
            ['Основы дирижирования', 'Дир.', 0, 1],
            ['Основы изобразительного искусства', 'Осн.ИЗО', 0, 1],
            ['Основы изобразительной грамоты общ', 'ОИГ общ', 0, 1],
            ['Основы изобразительной грамоты', 'ОИГ', 0, 1],
            ['Основы импровизации', 'Импр-я', 0, 1],
            ['Основы народного танца', 'ОНТ', 0, 1],
            ['Основы русского народного танца', 'ОРНТ', 0, 1],
            ['Основы сценического мастерства', 'Основы сц.маст-ва', 0, 1],
            ['Основы хореографии', 'Осн.хореогр.', 0, 1],
            ['Основы эстрадного танца', 'Основы эстр.танца', 0, 1],
            ['Партерная гимнастика', 'Парт.гим-ка', 0, 1],
            ['Пластика', 'Пластика', 0, 1],
            ['Пластическая, конструктивная лепка', 'ПКЛ', 0, 1],
            ['Пленэр', 'Пленэр', 0, 1],
            ['Проект', 'Проект', 0, 1],
            ['Развитие речи', 'Раз.реч.', 0, 1],
            ['Разминка', 'Разминка', 0, 1],
            ['Растяжка', 'Растяжка', 0, 1],
            ['Рисунок', 'Рис.', 0, 1],
            ['Ритм гитара', 'Р.гит', 0, 1],
            ['Ритмика и танец', 'Ритм.тан', 0, 1],
            ['Ритмика', 'Рит.', 0, 1],
            ['Ритмическое сольфеджио', 'Ритм.сольф.', 0, 1],
            ['Саксофон', 'Сакс', 0, 1],
            ['Саксофон', 'Сакс', 0, 1],
            ['Сводная репетиция ОРНТ', 'Св.реп.орнт', 0, 1],
            ['Сводная репетиция фольклорного ансамбля', 'Св.реп.фольк.анс', 0, 1],
            ['Сводная репетиция хора', 'Св.реп.хор.', 0, 1],
            ['Сводный струнный ансамбль', 'Св.стр.анс.', 0, 1],
            ['Скетчинг', 'Скетч.', 0, 1],
            ['Скрипка', 'Скр', 0, 1],
            ['Скульптура', 'Скульпт.', 0, 1],
            ['Слушание музыки и музыкальная грамота', 'Сл.муз.и муз.гр.', 0, 1],
            ['Слушание музыки', 'Сл.муз.', 0, 1],
            ['Современная хореография', 'Совр.хореогр.', 0, 1],
            ['Современный танец', 'Совр.танец', 0, 1],
            ['Сольфеджио', 'Сольф.', 0, 1],
            ['Сочинение и аккомпанемент', 'Соч.акк.', 0, 1],
            ['Сочинение и композиция', 'Соч.и комп.', 0, 1],
            ['Струнный ансамбль', 'Стр.анс', 0, 1],
            ['Сцена', 'Сцена', 0, 1],
            ['Сценическая речь', 'Сц.речь', 0, 1],
            ['Сценическое движение', 'Сц.дв.', 0, 1],
            ['Сценическое мастерство', 'Сц.М', 0, 1],
            ['Танцевальная практика', 'Танц.практ.', 0, 1],
            ['Тенор', 'Тенор', 0, 1],
            ['Теория и история джазовой музыки', 'ТИДМ', 0, 1],
            ['Теория музыки', 'т/м', 0, 1],
            ['Тромбон', 'Тром', 0, 1],
            ['Труба', 'Труб', 0, 1],
            ['Туба', 'Туба', 0, 1],
            ['Ударные', 'Удар', 0, 1],
            ['Флейта', 'Фле', 0, 1],
            ['Фольклорный ансамбль', 'Ф.анс.', 0, 1],
            ['Формовка', 'Форм.', 0, 1],
            ['Формообразование', 'ФО', 0, 1],
            ['Фортепиано', 'Ф-но', 0, 1],
            ['Характерный танец', 'Характ.тан.', 0, 1],
            ['Хор спец.гр.', 'Хор спец.гр.', 0, 1],
            ['Хор', 'Хор', 0, 1],
            ['Хоровой класс', 'Хор.класс.', 0, 1],
            ['Художественная керамика', 'Худ.Кер.', 0, 1],
            ['Художественное слово', 'Худ.сл.', 0, 1],
            ['Черчение', 'Черч.', 0, 1],
            ['Чтение с листа', 'Чт.лист', 0, 1],
            ['Чтение хоровых партитур', 'Чт.хор.п.', 0, 1],
            ['Чудеса в ладошках', 'ЧВЛ', 0, 1],
            ['Шликерное литьё', 'Литьё', 0, 1],
            ['Электронно-компьютерное музицирование', 'ЭКМ', 0, 1],
            ['Эстрадно-джазовое пение', 'Эст.дж.пен.', 0, 1],
            ['Эстрадно-джазовый оркестр', 'Джаз.орк.', 0, 1],
            ['Эстрадный вокал', 'Эстр.вок', 0, 1],
            ['Эстрадный танец', 'эстр.тан.', 0, 1],
            ['Body Ballet', 'Body Ballet', 0, 1],
            ['"Всезнайки" - класс раннего развития', '"Всезнайки"', 0, 1],
            ['"Знайки" - класс раннего развития', '"Знайки"', 0, 1],
            ['"Познайки"- класс раннего развития', '"Познайки"', 0, 1],
            ['"Почемучки" - класс раннего развития', '"Почемучки"', 0, 1],
        ])->execute();

        $this->createTable('{{%subject_category_item}}', [
            'id' => $this->tinyInteger(2)->unsigned()->notNull()->append('AUTO_INCREMENT PRIMARY KEY'),
            'name' => $this->string(127),
            'slug' => $this->string(64)->notNull(),
            'order' => $this->tinyInteger(2)->unsigned()->notNull(),
            'status' => $this->tinyInteger(2)->unsigned()->notNull(),
        ], $tableOptions);

        $this->db->createCommand()->batchInsert('{{%subject_category_item}}', ['name', 'slug', 'order', 'status'], [
            ['Специальность', 'Спец.', 0, 1],
            ['Музыкальный инструмент', 'Инстр', 0, 1],
            ['Дисциплины отдела', 'Дис.отд.', 0, 1],
            ['Общие дисциплины', 'Общ.', 0, 1],
            ['Предмет по выбору', 'П/в.', 0, 1],
            ['Коллективное музицирование', 'Кол.муз.', 0, 1],
            ['Сводные репетиции', 'Св.реп', 0, 1],
        ])->execute();

        $this->createTable('{{%subject_vid_item}}', [
            'id' => $this->tinyInteger(2)->notNull()->append('AUTO_INCREMENT PRIMARY KEY'),
            'name' => $this->string(64)->notNull(),
            'slug' => $this->string(32)->notNull(),
            'qty_min' => $this->smallInteger(3)->unsigned()->notNull(),
            'qty_max' => $this->smallInteger(3)->unsigned()->notNull(),
            'info' => $this->text()->notNull(),
            'status' => $this->tinyInteger(1)->notNull(),
        ], $tableOptions);

        $this->db->createCommand()->batchInsert('{{%subject_vid_item}}', ['name', 'slug','qty_min','qty_max','info','status'], [
            ['Индивидуальные', 'Инд.', 0, 1,'',1],
            ['Мелкогрупповые', 'Мелк-гр.', 0, 1,'',1],
            ['Групповые', 'Гр.', 0, 1,'',1],
        ])->execute();

        $this->createTable('{{%subject_department}}', [
            'id' => $this->primaryKey(8)->unsigned(),
            'subject_id' => $this->integer(8)->unsigned()->notNull(),
            'department_id' => $this->tinyInteger(2)->unsigned()->notNull(),
        ], $tableOptions);

        $this->createIndex('department_id', '{{%subject_department}}', 'department_id');
        $this->createIndex('subject_id', '{{%subject_department}}', 'subject_id');
        $this->addForeignKey('subject_department_ibfk_1', '{{%subject_department}}', 'department_id', '{{%department}}', 'id', 'NO ACTION', 'NO ACTION');
        $this->addForeignKey('subject_department_ibfk_2', '{{%subject_department}}', 'subject_id', '{{%subject}}', 'id', 'NO ACTION', 'NO ACTION');

        $this->createTable('{{%subject_category}}', [
            'id' => $this->primaryKey(8)->unsigned(),
            'subject_id' => $this->integer(8)->unsigned()->notNull(),
            'category_id' => $this->tinyInteger(2)->unsigned()->notNull(),
        ], $tableOptions);

        $this->createIndex('category_id', '{{%subject_category}}', 'category_id');
        $this->createIndex('subject_id', '{{%subject_category}}', 'subject_id');
        $this->addForeignKey('subject_category_ibfk_1', '{{%subject_category}}', 'category_id', '{{%subject_category_item}}', 'id', 'NO ACTION', 'NO ACTION');
        $this->addForeignKey('subject_category_ibfk_2', '{{%subject_category}}', 'subject_id', '{{%subject}}', 'id', 'NO ACTION', 'NO ACTION');

        $this->createTable('{{%subject_vid}}', [
            'id' => $this->primaryKey(8)->unsigned(),
            'subject_id' => $this->integer(8)->unsigned()->notNull(),
            'vid_id' => $this->tinyInteger(2)->unsigned()->notNull(),
        ], $tableOptions);

        $this->createIndex('vid_id', '{{%subject_vid}}', 'vid_id');
        $this->createIndex('subject_id', '{{%subject_vid}}', 'subject_id');
//        $this->addForeignKey('subject_vid_ibfk_1', '{{%subject_vid}}', 'vid_id', '{{%subject_vid_item}}', 'id', 'NO ACTION', 'NO ACTION');
        $this->addForeignKey('subject_vid_ibfk_2', '{{%subject_vid}}', 'subject_id', '{{%subject}}', 'id', 'NO ACTION', 'NO ACTION');

        $this->createTable('{{%subject_type}}', [
            'id' => $this->tinyInteger(2)->unsigned()->notNull()->append('AUTO_INCREMENT PRIMARY KEY'),
            'name' => $this->string(127)->notNull(),
            'slug' => $this->string(64)->notNull(),
            'status' => $this->tinyInteger(1)->unsigned()->notNull(),
        ], $tableOptions);

        $this->db->createCommand()->batchInsert('{{%subject_type}}', ['name', 'slug', 'status'], [
            ['Бюджет', 'Бюд.', 1],
            ['Хозрасчет', 'х/р.', 1],
        ])->execute();
    }

    public function down()
    {
        $this->dropTable('{{%subject_type}}');
        $this->dropTable('{{%subject_vid}}');
        $this->dropTable('{{%subject_category}}');
        $this->dropTable('{{%subject_department}}');
        $this->dropTable('{{%subject_vid_item}}');
        $this->dropTable('{{%subject_category_item}}');
        $this->dropTable('{{%subject}}');
    }
}
