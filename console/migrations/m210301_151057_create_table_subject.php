<?php

use yii\db\Migration;

class m210301_151057_create_table_subject extends Migration
{
    public function up()
    {
        $tableOptions = null;
        if ($this->db->driverName === 'mysql') {
            $tableOptions = 'CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE=InnoDB';
        }

        $this->createTable('{{%subject}}', [
            'id' => $this->primaryKey(8)->unsigned(),
            'name' => $this->string(64),
            'slug' => $this->string(32),
            'status' => $this->tinyInteger(2)->unsigned()->notNull(),
        ], $tableOptions);

        $this->db->createCommand()->batchInsert('{{%subject}}', ['name', 'slug', 'status'], [
            ['Академический вокал', 'Акад.вок.', 1],
            ['Аккордеон', 'Акк-н', 1],
            ['Акробатика', 'Акробатика', 1],
            ['Актерское мастерство', 'Акт.маст', 1],
            ['Альт', 'Альт', 1],
            ['Ансамбль духовых инструментов', 'Анс.дух.инстр.', 1],
            ['Ансамбль народных инструментов', 'Анс.нар.инстр.', 1],
            ['Ансамбль', 'Анс.', 1],
            ['Арфа', 'Арфа', 1],
            ['Архитектурное творчество', 'Арх.тв.', 1],
            ['Архитектурные стили', 'Арх.ст.', 1],
            ['Архитектурный рисунок', 'Арх.рис.', 1],
            ['Балалайка', 'Бал', 1],
            ['Баллетная гимнастика', 'Бал.гимн', 1],
            ['Бально-спортивный танец', 'Бал-спорт.тан', 1],
            ['Баритон', 'Барит', 1],
            ['Бас гитара', 'Б.гит', 1],
            ['Баян', 'Баян', 1],
            ['Беседы об искусстве', 'Беседы об иск-ве', 1],
            ['Беседы по хореографическому искусству', 'Беседы по хореогр-му иск-ву', 1],
            ['Блок флейта', 'Бл.фл', 0, 1],
            ['Брейк-данс', 'Брейк-данс', 1],
            ['Валторна', 'Валт', 1],
            ['Веселая арифметика', 'Арифм.', 1],
            ['Веселые нотки', 'Вес.нотки', 1],
            ['Виолончель', 'Виол', 1],
            ['Вокал', 'Вок', 1],
            ['Вокально-хоровой ансамбль', 'Вок-хор.анс.', 1],
            ['Вокальный ансамбль', 'Вок.анс.', 1],
            ['Вокальный эстрадно-джазовый ансамбль', 'Вок.анс.', 1],
            ['Гармонь', 'Гарм', 1],
            ['Гимнастика', 'Гим-ка', 1],
            ['Гитара', 'Гитар', 1],
            ['Графика', 'Граф.', 1],
            ['Гусли', 'Гусли', 1],
            ['Декоративно-прикладное искусство', 'ДПИ', 1],
            ['Декорирование', 'Декор', 1],
            ['Детские массовые танцы', 'ДМТ', 1],
            ['Джазовый ансамбль', 'джаз.анс.', 1],
            ['Домра', 'Домр', 1],
            ['Живопись', 'Жив-сь.', 1],
            ['Импровизация', 'Импр.', 1],
            ['Историко-бытовой и бальный танец', 'Бальн.тан.', 1],
            ['История архитектуры', 'Ист.арх.', 1],
            ['История джаза', 'Ист.дж.', 1],
            ['История изобразительного искусства', 'Ист.ИЗО', 1],
            ['История искусств', 'Ист.иск.', 1],
            ['Кларнет', 'Клар', 1],
            ['Классический станок', 'Класс.ст.', 1],
            ['Классический танец', 'Класс.танец', 1],
            ['Классический экзерсис', 'Кл.Экз', 1],
            ['Композиционная постановка танца', 'КПТ', 1],
            ['Композиция (станковая, прикладная)', 'Комп.', 1],
            ['Композиция', 'Комп', 1],
            ['Латина соло', 'Латина соло', 1],
            ['Лепка', 'Лепка', 1],
            ['Логопедия', 'Лого', 1],
            ['Логоритмика', 'Логоритмика', 1],
            ['Макетирование', 'Макет', 1],
            ['Мастерство актера', 'Маст.акт.', 1],
            ['Материаловедение', 'Мат.вед.', 1],
            ['Музыкальная грамота', 'Муз.гр.', 1],
            ['Музыкальная информатика', 'Муз.инф.', 1],
            ['Музыкальная литература и слушание музыки', 'Муз.лит.сл.муз.', 1],
            ['Музыкальная литература', 'Муз.лит.', 1],
            ['Народная хореография', 'Нар.хореогр.', 1],
            ['Народно-сценический танец', 'Нар-сц.тан.', 1],
            ['Народное творчество', 'Нар.тв-во', 1],
            ['Народный оркестр', 'Нар.орк.', 1],
            ['Народный характерный танец', 'НХТ', 1],
            ['Народный хор', 'Нар.хор', 1],
            ['Натурный рисунок', 'Нат.рис.', 1],
            ['Орган', 'Орган', 1],
            ['Оркестр аккордеонистов', 'Орк. аккорд.', 1],
            ['Оркестр гитаристов', 'орк.гит.', 1],
            ['Оркестр духовых инструментов', 'дух.орк.', 1],
            ['Основы ИЗО', 'Осн.ИЗО', 1],
            ['Основы актерского мастерства', 'Осн.акт.маст.', 1],
            ['Основы бального танца', 'Основы бальн.танца', 1],
            ['Основы графики', 'Осн.граф.', 1],
            ['Основы дирижирования', 'Дир.', 1],
            ['Основы изобразительного искусства', 'Осн.ИЗО', 1],
            ['Основы изобразительной грамоты общ', 'ОИГ общ', 1],
            ['Основы изобразительной грамоты', 'ОИГ', 1],
            ['Основы импровизации', 'Импр-я', 1],
            ['Основы народного танца', 'ОНТ', 1],
            ['Основы русского народного танца', 'ОРНТ', 1],
            ['Основы сценического мастерства', 'Основы сц.маст-ва', 1],
            ['Основы хореографии', 'Осн.хореогр.', 1],
            ['Основы эстрадного танца', 'Основы эстр.танца', 1],
            ['Партерная гимнастика', 'Парт.гим-ка', 1],
            ['Пластика', 'Пластика', 1],
            ['Пластическая, конструктивная лепка', 'ПКЛ', 1],
            ['Пленэр', 'Пленэр', 1],
            ['Проект', 'Проект', 1],
            ['Развитие речи', 'Раз.реч.', 1],
            ['Разминка', 'Разминка', 1],
            ['Растяжка', 'Растяжка', 1],
            ['Рисунок', 'Рис.', 1],
            ['Ритм гитара', 'Р.гит', 1],
            ['Ритмика и танец', 'Ритм.тан', 1],
            ['Ритмика', 'Рит.', 1],
            ['Ритмическое сольфеджио', 'Ритм.сольф.', 1],
            ['Саксофон', 'Сакс', 1],
            ['Сводная репетиция ОРНТ', 'Св.реп.орнт', 1],
            ['Сводная репетиция фольклорного ансамбля', 'Св.реп.фольк.анс', 1],
            ['Сводная репетиция хора', 'Св.реп.хор.', 1],
            ['Сводный струнный ансамбль', 'Св.стр.анс.', 1],
            ['Скетчинг', 'Скетч.', 1],
            ['Скрипка', 'Скр', 1],
            ['Скульптура', 'Скульпт.', 1],
            ['Слушание музыки и музыкальная грамота', 'Сл.муз.и муз.гр.', 1],
            ['Слушание музыки', 'Сл.муз.', 1],
            ['Современная хореография', 'Совр.хореогр.', 1],
            ['Современный танец', 'Совр.танец', 1],
            ['Сольфеджио', 'Сольф.', 1],
            ['Сочинение и аккомпанемент', 'Соч.акк.', 1],
            ['Сочинение и композиция', 'Соч.и комп.', 1],
            ['Струнный ансамбль', 'Стр.анс', 1],
            ['Сцена', 'Сцена', 1],
            ['Сценическая речь', 'Сц.речь', 1],
            ['Сценическое движение', 'Сц.дв.', 1],
            ['Сценическое мастерство', 'Сц.М', 1],
            ['Танцевальная практика', 'Танц.практ.', 1],
            ['Тенор', 'Тенор', 1],
            ['Теория и история джазовой музыки', 'ТИДМ', 1],
            ['Теория музыки', 'т/м', 1],
            ['Тромбон', 'Тром', 1],
            ['Труба', 'Труб', 1],
            ['Туба', 'Туба', 1],
            ['Ударные', 'Удар', 1],
            ['Флейта', 'Фле', 1],
            ['Фольклорный ансамбль', 'Ф.анс.', 1],
            ['Формовка', 'Форм.', 1],
            ['Формообразование', 'ФО', 1],
            ['Фортепиано', 'Ф-но', 1],
            ['Характерный танец', 'Характ.тан.', 1],
            ['Хор спец.гр.', 'Хор спец.гр.', 1],
            ['Хор', 'Хор', 1],
            ['Хоровой класс', 'Хор.класс.', 1],
            ['Художественная керамика', 'Худ.Кер.', 1],
            ['Художественное слово', 'Худ.сл.', 1],
            ['Черчение', 'Черч.', 1],
            ['Чтение с листа', 'Чт.лист', 1],
            ['Чтение хоровых партитур', 'Чт.хор.п.', 1],
            ['Чудеса в ладошках', 'ЧВЛ', 1],
            ['Шликерное литьё', 'Литьё', 1],
            ['Электронно-компьютерное музицирование', 'ЭКМ', 1],
            ['Эстрадно-джазовое пение', 'Эст.дж.пен.', 1],
            ['Эстрадно-джазовый оркестр', 'Джаз.орк.', 1],
            ['Эстрадный вокал', 'Эстр.вок', 1],
            ['Эстрадный танец', 'эстр.тан.', 1],
            ['Body Ballet', 'Body Ballet', 1],
            ['"Всезнайки" - класс раннего развития', '"Всезнайки"', 1],
            ['"Знайки" - класс раннего развития', '"Знайки"', 1],
            ['"Познайки"- класс раннего развития', '"Познайки"', 1],
            ['"Почемучки" - класс раннего развития', '"Почемучки"', 1],
        ])->execute();

        $this->createTable('{{%subject_category_item}}', [
            'id' => $this->tinyInteger(2)->unsigned()->notNull()->append('AUTO_INCREMENT PRIMARY KEY'),
            'name' => $this->string(127),
            'slug' => $this->string(64)->notNull(),
            'status' => $this->tinyInteger(2)->unsigned()->notNull(),
            'sortOrder' => $this->tinyInteger(2)->unsigned()->notNull(),
        ], $tableOptions);

        $this->db->createCommand()->batchInsert('{{%subject_category_item}}', ['name', 'slug', 'sortOrder', 'status'], [
            [1, 'Специальность', 'Спец.', 1, 1],
            [2, 'Музыкальный инструмент', 'Инстр', 2, 1],
            [3, 'Дисциплины отдела', 'Дис.отд.', 3, 1],
            [4, 'Общие дисциплины', 'Общ.', 4, 1],
            [5, 'Предмет по выбору', 'П/в.', 5, 1],
            [6, 'Коллективное музицирование', 'Кол.муз.', 6, 1],
            [7, 'Сводные репетиции', 'Св.реп', 7, 1],
        ])->execute();

        $this->createTable('{{%subject_vid_item}}', [
            'id' => $this->tinyInteger(2)->notNull()->append('AUTO_INCREMENT PRIMARY KEY'),
            'name' => $this->string(64)->notNull(),
            'slug' => $this->string(32)->notNull(),
            'qty_min' => $this->smallInteger(3)->unsigned()->notNull(),
            'qty_max' => $this->smallInteger(3)->unsigned()->notNull(),
            'info' => $this->text()->notNull(),
            'status' => $this->tinyInteger(1)->notNull(),
        ], $tableOptions);

        $this->db->createCommand()->batchInsert('{{%subject_vid_item}}', ['name', 'slug','qty_min','qty_max','info','status'], [
            ['Индивидуальные', 'Инд.', 0, 1,'',1],
            ['Мелкогрупповые', 'Мелк-гр.', 0, 1,'',1],
            ['Групповые', 'Гр.', 0, 1,'',1],
        ])->execute();

        $this->createTable('{{%subject_department}}', [
            'id' => $this->primaryKey(8)->unsigned(),
            'subject_id' => $this->integer(8)->unsigned()->notNull(),
            'department_id' => $this->tinyInteger(2)->unsigned()->notNull(),
        ], $tableOptions);

        $this->createIndex('department_id', '{{%subject_department}}', 'department_id');
        $this->createIndex('subject_id', '{{%subject_department}}', 'subject_id');
        $this->addForeignKey('subject_department_ibfk_1', '{{%subject_department}}', 'department_id', '{{%department}}', 'id', 'NO ACTION', 'NO ACTION');
        $this->addForeignKey('subject_department_ibfk_2', '{{%subject_department}}', 'subject_id', '{{%subject}}', 'id', 'NO ACTION', 'NO ACTION');

        $this->createTable('{{%subject_category}}', [
            'id' => $this->primaryKey(8)->unsigned(),
            'subject_id' => $this->integer(8)->unsigned()->notNull(),
            'category_id' => $this->tinyInteger(2)->unsigned()->notNull(),
        ], $tableOptions);

        $this->createIndex('category_id', '{{%subject_category}}', 'category_id');
        $this->createIndex('subject_id', '{{%subject_category}}', 'subject_id');
        $this->addForeignKey('subject_category_ibfk_1', '{{%subject_category}}', 'category_id', '{{%subject_category_item}}', 'id', 'NO ACTION', 'NO ACTION');
        $this->addForeignKey('subject_category_ibfk_2', '{{%subject_category}}', 'subject_id', '{{%subject}}', 'id', 'NO ACTION', 'NO ACTION');

        $this->createTable('{{%subject_vid}}', [
            'id' => $this->primaryKey(8)->unsigned(),
            'subject_id' => $this->integer(8)->unsigned()->notNull(),
            'vid_id' => $this->tinyInteger(2)->unsigned()->notNull(),
        ], $tableOptions);

        $this->createIndex('vid_id', '{{%subject_vid}}', 'vid_id');
        $this->createIndex('subject_id', '{{%subject_vid}}', 'subject_id');
//        $this->addForeignKey('subject_vid_ibfk_1', '{{%subject_vid}}', 'vid_id', '{{%subject_vid_item}}', 'id', 'NO ACTION', 'NO ACTION');
        $this->addForeignKey('subject_vid_ibfk_2', '{{%subject_vid}}', 'subject_id', '{{%subject}}', 'id', 'NO ACTION', 'NO ACTION');

        $this->createTable('{{%subject_type}}', [
            'id' => $this->tinyInteger(2)->unsigned()->notNull()->append('AUTO_INCREMENT PRIMARY KEY'),
            'name' => $this->string(127)->notNull(),
            'slug' => $this->string(64)->notNull(),
            'status' => $this->tinyInteger(1)->unsigned()->notNull(),
        ], $tableOptions);

        $this->db->createCommand()->batchInsert('{{%subject_type}}', ['name', 'slug', 'status'], [
            ['Бюджет', 'Бюд.', 1],
            ['Хозрасчет', 'х/р.', 1],
        ])->execute();
    }

    public function down()
    {
        $this->dropTable('{{%subject_type}}');
        $this->dropTable('{{%subject_vid}}');
        $this->dropTable('{{%subject_category}}');
        $this->dropTable('{{%subject_department}}');
        $this->dropTable('{{%subject_vid_item}}');
        $this->dropTable('{{%subject_category_item}}');
        $this->dropTable('{{%subject}}');
    }
}
